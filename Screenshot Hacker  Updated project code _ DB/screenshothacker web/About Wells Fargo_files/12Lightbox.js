WF.Component.LightBox=function(trigger,options){if(!trigger.id){trigger.id=WF.Utils.generateUniqueId(trigger);}this.elem=trigger;this.id="LightBox_"+trigger.id;this.version="1.0.1";var self=this;var cache="",contentContainer=$("<div/>"),darkBackdrop=$("#c28backdrop"),defaultHeight=500,defaultWidth=722,destPid="",dimensions={},dir="",exitHeightAdjust=190,exitWidthAdjust=0,fadeTime=300,helperDialog=$("<div/>"),mainContainer=$("#c28lightbox"),margin=50,maxHeight=500,maxWidth=722,showHideSpeed=600,stdHeightAdjust=39,stdWidthAdjust=0,targetPageExtraJs=[],timer,videoWidth=775;var stdOptions={pleaseWaitDelay:1500,timeout:10000,onTimeout:false,postInit:false,beforeOpenFunc:false,afterCloseFunc:false,disableCache:false,isExit:false,isQuiz:false,exitPageDestination:"",noCloseButton:false,showPrintIcon:false,url:"",method:"GET",parameters:{}};this.addDialogCloseButton=function(){helperDialog.append('<div class="closeButton"><a href="#" class="c7 utilitybtn" role="button">'+WF.Strings.Components.LightboxOverlay.closeDialog[WF.Page.lang]+"</a></div>");helperDialog.find(".c7").click(function(evt){evt.preventDefault();helperDialog.fadeOut(fadeTime,function(){helperDialog.remove();});});};this.addLightboxEvents=function(){mainContainer.find("a.c28close, a.c28cancel").click(function(evt){evt.preventDefault();self.hide();});mainContainer.keydown(function(evt){if(evt.keyCode==27){self.hide();}});$(window).resize(function(){self.positionLightbox();});};this.createLightboxHtml=function(content,titleAndSubhead,evt){mainContainer.unbind().empty();var topContainer=$("<div/>").addClass("c28topContainer");topContainer.appendTo(mainContainer);if(options.noCloseButton===false){var closeButton=$("<img/>").attr({"alt":WF.Strings.Shared.close[WF.Page.lang],"role":"button"});topContainer.html('<a class="c28close" id="c28close" href="#"></a>');topContainer.find("a").append(closeButton);WF.Utils.setImageSrcFromBackground(closeButton,"12Lightbox 85; closeButton");}var topFocus=$("<span/>").attr({"id":"c28topFocus","class":"hidden","tabindex":0});topFocus.focus(function(evt){if(dir=="back"){$("#c28bottomFocus").get(0).focus();}else{$("#c28close").focus();}}).prependTo(mainContainer);$("#c28close").focus(function(){dir="back";});contentContainer.addClass("c28contentContainer");contentContainer.html(content).appendTo(mainContainer);if(options.isExit){topContainer.addClass("exitPage");var exitLogo=$("<img/>").attr({"alt":WF.Strings.Shared.WFHomePage[WF.Page.lang],"id":"exitLogo"});topContainer.append(exitLogo);WF.Utils.setImageSrcFromBackground(exitLogo,"12Lightbox 109; exitLogo");mainContainer.append($('<div class="c28bottomButtons"><a href="#" class="c28close">'+WF.Strings.Shared.cancel[WF.Page.lang]+'</a><a href="'+options.exitUrl+'" class="c7 utilitybtn" role="button">'+WF.Strings.Shared["continue"][WF.Page.lang]+"</a></div>"));var $actionButton=mainContainer.find(".c28bottomButtons").find("a.c7");$actionButton.attr("target","_blank");$actionButton.bind("click keypress",function(evt){if(evt.type=="keypress"&&evt.keyCode!=13){return;}WF.Utils.trackVS({"suppressAsync":true,"event":"LinkActivated","eventType":evt.type,"eventDescription":"exitPageContinue","destinationUrl":this.href});});if(options.exitPageDestination){$actionButton.attr("href",options.exitPageDestination);$actionButton.attr("target","_blank");}mainContainer.find(".c28bottomButtons").find("a.c28cancel").bind("click keypress",function(evt){if(evt.type=="keypress"&&evt.keyCode!=13){return;}WF.Utils.trackVS({"event":"LinkActivated","eventType":evt.type,"eventDescription":"exitPageCancel"});if(evt.type=="keypress"){self.hide();evt.preventDefault();}});$(".c28bottomButtons").find("a.c7").attr("id","c28lastFocusable");}else{topContainer.removeClass("exitPage");var heightAdj="";if(options.isQuiz){stdHeightAdjust+=12;}if(titleAndSubhead.title){topContainer.append("<h2>"+titleAndSubhead.title+"</h2>");heightAdj+="Title";}if(titleAndSubhead.subhead){topContainer.append("<h3>"+titleAndSubhead.subhead+"</h3>");heightAdj+="Subhead";}if(options.showPrintIcon){topContainer.append($('<a href="javascript:window.print();" class="c28print">'+WF.Strings.Shared.print[WF.Page.lang]+"</a>"));heightAdj+="Print";}switch(heightAdj){case"Title":case"TitlePrint":stdHeightAdjust+=18;break;case"TitleSubhead":case"TitleSubheadPrint":stdHeightAdjust+=38;break;case"Print":stdHeightAdjust+=14;break;}var btmFocus=mainContainer.find("a, input, select");if(btmFocus.length){btmFocus=$(btmFocus[btmFocus.length-1]);}else{btmFocus=topContainer.find("a.c28print");}btmFocus.attr("id","c28lastFocusable");}var bottomFocus=$("<span/>").attr({"id":"c28bottomFocus","class":"hidden","tabindex":0});bottomFocus.focus(function(evt){if(dir=="back"){contentContainer.get(0).focus();}else{$("#c28topFocus").get(0).focus();}}).appendTo(mainContainer);$("#c28lastFocusable").focus(function(){dir="forward";});self.setLightboxSizes();self.addLightboxEvents();$.each(targetPageExtraJs,function(i,src){$("body").append($('<script src="'+src+'"><\/script>'));});cache=mainContainer.contents().clone(true);self.show(evt);};this.createLoadingDialogHtml=function(){helperDialog.html("").attr("class","c28loading");helperDialog.append("<h2>"+WF.Strings.Components.LightboxOverlay.oneMomentPlease[WF.Page.lang]+"</h2>");var loadingImg=$('<img class="loadImg"/>');helperDialog.append(loadingImg);helperDialog.append(WF.Strings.Components.LightboxOverlay.plsWaitGettingInfo[WF.Page.lang]);$("body").append(helperDialog);WF.Utils.setImageSrcFromBackground(loadingImg,"12Lightbox 204; loadingImg");};this.doTimeout=function(){helperDialog.html("<h2>"+WF.Strings.Components.LightboxOverlay.infoCurrUnavail[WF.Page.lang]+"</h2>").addClass("timeout");helperDialog.append("<p>"+WF.Strings.Components.LightboxOverlay.apologizeTryAgain[WF.Page.lang]+"</p>");self.addDialogCloseButton();helperDialog.fadeIn(fadeTime);};this.getContentRegion=function(data){data="<div>"+data+"</div>";var content=$(data).find("#content");if(content.length){if(content.hasClass(".exitPageContent")){options.isExit=true;}}else{content=$(data).find(".exitPageContent");if(content.length){options.isExit=true;}}if(!content.length){content=$(data).find(".mainContentCol:first");}if(content.find(".Onquiz").length){options.isQuiz=true;}return content;};this.getContentTrackingData=function(data){data="<div>"+data+"</div>";var pid=$(data).find("#shell").data("pid");var ptid=$(data).find("#shell").data("ptid");return pid+"~"+ptid;};this.getDimensions=function(html){var ret={width:0,height:0};var match;html="<div>"+html+"</div>";var node=$(html).find("#shell");if(node.length){if(node.data("lightboxWidth")&&node.data("lightboxHeight")){ret.width=node.data("lightboxWidth");ret.height=node.data("lightboxHeight");}else{match=node.attr("class").match(/\b(\d\d\d?\d?)x(\d\d\d?\d?)\b/);if(match){ret.width=parseInt(match[1],10);ret.height=parseInt(match[2],10);}}}if(!ret.width){$.each(["#content",".exitPageContent",".mainContentCol:first"],function(i,css){node=$(html).find(css);if(node.length&&node.attr("class")){match=node.attr("class").match(/\b(\d\d\d?\d?)x(\d\d\d?\d?)\b/);if(match){ret.width=parseInt(match[1],10);ret.height=parseInt(match[2],10);return false;}}});}if(!ret.width){ret={width:defaultWidth,height:defaultHeight};}if(ret.width>maxWidth){ret.width=maxWidth;}if(ret.height>maxHeight){ret.height=maxHeight;}if($(html).find(".c51").not(".audio").length){ret.width=videoWidth;}return ret;};this.getExitPageUrl=function(html){html="<div>"+html+"</div>";var link=$(html).find(".t7buttons a.c7");if(link.length){return link.attr("href");}link=$(html).find('a.c7:contains("'+WF.Strings.Shared["continue"][WF.Page.lang]+'")');if(link.length){return link.attr("href");}return"";};this.getOptionsFromTrigger=function(){if($(trigger).hasClass("c28cLink")){options.isExit=true;}if(trigger.tagName.toLowerCase()=="a"){if(trigger.href.indexOf("?")!=-1){options.url=trigger.href.substr(0,trigger.href.indexOf("?"));var params=trigger.href.substr(trigger.href.indexOf("?")+1);params=params.split(/&(?:amp;)?/);
$.each(params,function(idx,param){var p=param.split("=");options.parameters[p[0]]=p[1];});}else{options.url=trigger.href;}}if($(trigger).data("lightboxOptions")){var dataOpts=$(trigger).data("lightboxOptions");if(typeof dataOpts=="string"){dataOpts=JSON.parse(dataOpts);}$.extend(true,options,dataOpts);}};this.getTitleAndSubhead=function(data){data="<div>"+data+"</div>";var ret={"title":"","subhead":""};if(options.isQuiz){return ret;}ret.title=$(data).find("h1.c11").text();ret.subhead=$(data).find("p.subhead").text();return ret;};this.handleAjaxResponse=function(data,evt){var content=self.getContentRegion(data);self.populateTargetPageExtraJs(data);destPid=self.getContentTrackingData(data);var titleAndSubhead=self.getTitleAndSubhead(data);dimensions=self.getDimensions(data);options.showPrintIcon=false;if(options.isExit){options.exitUrl=self.getExitPageUrl(data);}else{if(self.hasContentPrintOption(data)){options.showPrintIcon=true;}}self.createLightboxHtml(content,titleAndSubhead,evt);};this.hasContentPrintOption=function(data){data="<div>"+data+"</div>";var shell=$(data).find("#shell");if(shell.data("lightboxPrint")){return new Boolean(shell.data("lightboxPrint").toString());}return false;};this.hide=function(){$("body").removeClass("lightboxOpen");mainContainer.find(".c51 video, .c51 object").not(".c51.audio object").each(function(){try{var vid=videojs(this.id);vid.pause();vid.dispose();}catch(err){WF.Utils.ajaxLog(err);}});mainContainer.find(".c51 audio, .c51.audio object").each(function(){try{if(this.player){this.player.pause();}else{if(this.parentNode.player){this.parentNode.player.pause();}}}catch(err){WF.Utils.ajaxLog(err);}});mainContainer.find(".c28topContainer").find("a.c28close").hide();mainContainer.attr("aria-hidden","true").fadeOut(showHideSpeed,function(){darkBackdrop.addClass("hide");if($(trigger).is(":visible")){trigger.focus();}if(options.afterCloseFunc&&typeof options.afterCloseFunc=="function"){options.afterCloseFunc();}});helperDialog.fadeOut(showHideSpeed);};this.init=function(evt){self.hideOpenSocialShares();if(cache){self.show(evt);}else{self.requestContent(evt);}if(typeof options.postInit=="function"){options.postInit;}};this.populateTargetPageExtraJs=function(data){var hostPageJsSources=[],targetJsSources=data.match(/<script[^>]+src=['"]([^'"]+)['"]/g);$("script[src]").each(function(){hostPageJsSources.push($(this).attr("src"));});if(targetJsSources!=null){targetJsSources=$.map(targetJsSources,function(str){str=str.replace(/<script[^>]+src=['"]/,"");str=str.replace(/['"]$/,"");return str;});$.each(targetJsSources,function(idx,val){if($.inArray(val,hostPageJsSources)==-1){targetPageExtraJs.push(val);}});}};this.positionLightbox=function(){var screenWidth=$(window).width();var screenHeight=$(window).height();var dlgWidth=mainContainer.width();var dlgHeight=mainContainer.height();var scrollX=(window.pageXOffset!==undefined)?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft;var scrollY=(window.pageYOffset!==undefined)?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;var left=Math.floor((screenWidth/2)-(dlgWidth/2))+scrollX;var top=Math.floor((screenHeight/2)-(dlgHeight/2))+scrollY;mainContainer.css({"top":top+"px","left":left+"px"});darkBackdrop.css({"width":screenWidth+"px","height":$(document).height()+"px"});};this.positionLoadingDialog=function(){var screenWidth=$(window).width();var screenHeight=$(window).height();var dlgWidth=helperDialog.width();var dlgHeight=helperDialog.height();var left=Math.floor((screenWidth/2)-(dlgWidth/2));var top=Math.floor((screenHeight/2)-(dlgHeight/2));helperDialog.css({"top":top+"px","left":left+"px"});};this.requestContent=function(evt){var inlineLightBox=$(trigger).attr("data-lbcontentId")||$(trigger).data("lbcontentId")||"";self.createLoadingDialogHtml();timer=setTimeout(function(){self.positionLoadingDialog();helperDialog.fadeIn(fadeTime);},options.pleaseWaitDelay);if(options.disableCache){options.parameters.cb=new Date().valueOf();}if(inlineLightBox===""){$.ajax({url:options.url,type:options.method,data:options.parameters,timeout:options.timeout,error:function(XMLHttpRequest,textStatus,errorThrown){if(textStatus=="timeout"){self.doTimeout();if(options.onTimeout){options.onTimeout.call(this,XMLHttpRequest,textStatus,errorThrown);}}else{self.showErrorDialog(XMLHttpRequest,textStatus,errorThrown);}},success:function(data){clearTimeout(timer);self.handleAjaxResponse(data,evt);}});}else{self.handleAjaxResponse($("#"+inlineLightBox).html(),evt);}};this.setLightboxSizes=function(){var heightAdjust=stdHeightAdjust,widthAdjust=stdWidthAdjust,screenWidth=$(window).width(),screenHeight=$(window).height();if(options.isExit){heightAdjust=exitHeightAdjust;widthAdjust=exitWidthAdjust;}contentContainer.css({"width":dimensions.width+"px","height":dimensions.height+"px"});mainContainer.css({"width":(dimensions.width+widthAdjust)+"px","height":(dimensions.height+heightAdjust)+"px"});};this.show=function(evt){helperDialog.fadeOut(showHideSpeed,function(){if(options.beforeOpenFunc&&typeof options.beforeOpenFunc=="function"){options.beforeOpenFunc();}});if(options.disableCache){cache="";}else{mainContainer.empty();mainContainer.append(cache.clone(true));}if($(".zipCodeDialog").attr("data-closebutton")=="hide"){mainContainer.addClass("zipdialogloaded");mainContainer.find(".c28close").click(function(evt){window.location.href="/";});setTimeout(function(){$(".zipCodeDialog").empty();},1000);}var divContent=$("#c28lightbox").find("div#content");var divContentClass=divContent.attr("class");if(divContentClass=="362x166"){$("#c28lightbox").find(".c28contentContainer").css("overflow","hidden");}self.setLightboxSizes();self.positionLightbox();darkBackdrop.removeClass("hide");$("body").addClass("lightboxOpen");mainContainer.fadeIn(showHideSpeed,function(){$(this).attr({"aria-labelledby":trigger.id,"aria-hidden":"false"}).find("a.c28close").show().focus();var h1=contentContainer.find("h1, h2, h3")[0];});WF.OnLoads.doAll(mainContainer);WF.Utils.trackVS({"event":"LinkActivated","eventType":evt.type,"eventDescription":"lightboxOpen","linkText":$(trigger).text(),"destinationUrl":trigger.href,"destinationPid":destPid,"clist":clist});if(mainContainer.find(".vjs-default-skin").length>0){try{var vidID=mainContainer.find(".vjs-default-skin").attr("id");_V_.players[vidID]=null;var vid=window.VideoJS(vidID);}catch(e){}}};this.showErrorDialog=function(XMLHttpRequest,textStatus,errorThrown){helperDialog.html("<h2>"+WF.Strings.Components.LightboxOverlay.errorEncountered[WF.Page.lang]+"</h2>").attr("class","c28error");helperDialog.append("<div>"+XMLHttpRequest.status+"</div>");helperDialog.append("<div>"+errorThrown+"</div>");self.addDialogCloseButton();$("body").append(helperDialog);self.positionLoadingDialog();helperDialog.fadeIn(fadeTime);};this.hideOpenSocialShares=function(){$(".c52Link.active").removeClass("active");$("div.c52").addClass("hide").attr("aria-hidden","true");$(".SocialShare .Popup").hide();};if(!options){options={parameters:{}};}if(trigger.href!==""){self.getOptionsFromTrigger();}for(var o in stdOptions){if(typeof options[o]=="undefined"){options[o]=stdOptions[o];}}var clist=WF.Utils.getClist(trigger);$(trigger).attr("aria-haspopup","true").bind("click keypress",function(evt){if(evt.type=="keypress"&&evt.keyCode!=13){return;}if($(this).attr("data-disable-cache")=="true"){options.disableCache=true;}evt.preventDefault();self.init(evt);});WF.Page.Components.LightBoxes.push(this);return this;};WF.OnLoads.setupLightboxes=function(root){if(typeof root=="undefined"){root=$("body");}if(!$("#c28backdrop").length){$('<div id="c28backdrop"/>').appendTo($("body"));}if(!$("#c28lightbox").length){$('<div id="c28lightbox" class="c28mainContainer" role="region" aria-hidden="true" />').appendTo($("body"));}$(root).find(".c28aLink, .c28cLink").each(function(){new WF.Component.LightBox(this);});};